<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sorteador de Times de Futebol</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827;
        }
        .star-rating svg {
            cursor: pointer;
            transition: color 0.2s;
        }
        /* Cor de preenchimento para as estrelas ativas e no hover */
        .star-rating .star.active {
            color: #f59e0b; /* ambar-500 */
        }
        .star-rating:hover .star {
             color: #f59e0b !important;
        }
        .star-rating .star:hover ~ .star {
            color: #6b7280 !important; /* cinza-500 */
        }
        #teams-container .team-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        #teams-container .team-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.2), 0 4px 6px -2px rgba(0, 0, 0, 0.1);
        }
        /* Animação para surgimento suave dos elementos */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }
        #close-ai-modal-btn {
            font-size: 2rem;
            line-height: 1;
        }
        #notification {
            transform: translateX(calc(100% + 2rem));
            transition: transform 0.5s ease-in-out;
        }
        #notification.show {
            transform: translateX(0);
        }
    </style>
</head>
<body class="text-white">

    <div class="container mx-auto p-4 md:p-8 max-w-5xl">
        <!-- Cabeçalho -->
        <header class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-bold text-amber-400">Sorteador de Times</h1>
            <p class="text-gray-400 mt-2 text-lg">Adicione os jogadores, defina a habilidade e sorteie times equilibrados.</p>
        </header>

        <main class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Coluna de Inserção e Lista de Jogadores -->
            <div class="bg-gray-800 p-6 rounded-2xl shadow-lg">
                <h2 class="text-2xl font-semibold mb-4 border-b border-gray-700 pb-2">Adicionar Jogador</h2>
                <!-- Formulário de inserção -->
                <form id="add-player-form" class="space-y-4">
                    <div>
                        <label for="player-name" class="block mb-2 text-sm font-medium text-gray-300">Nome do Jogador</label>
                        <input type="text" id="player-name" class="w-full bg-gray-700 border border-gray-600 rounded-lg p-2.5 text-white focus:ring-amber-500 focus:border-amber-500" placeholder="Ex: Neymar" required>
                    </div>
                    <div>
                        <label class="block mb-2 text-sm font-medium text-gray-300">Nível de Habilidade</label>
                        <div id="star-rating" class="star-rating flex items-center text-gray-500 text-3xl" data-skill="0">
                            <svg data-value="1" class="star w-8 h-8" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>
                            <svg data-value="2" class="star w-8 h-8" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>
                            <svg data-value="3" class="star w-8 h-8" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>
                            <svg data-value="4" class="star w-8 h-8" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>
                            <svg data-value="5" class="star w-8 h-8" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>
                            <svg data-value="6" class="star w-8 h-8" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>
                        </div>
                    </div>
                    <button type="submit" class="w-full text-white bg-amber-600 hover:bg-amber-700 focus:ring-4 focus:ring-amber-800 font-medium rounded-lg text-sm px-5 py-2.5 text-center">Adicionar Jogador</button>
                    <button type="button" id="open-ai-modal-btn" class="w-full text-white bg-blue-600 hover:bg-blue-700 focus:ring-4 focus:ring-blue-800 font-medium rounded-lg text-sm px-5 py-2.5 text-center mt-2">Adicionar em Lote com IA</button>
                </form>

                <!-- Lista de Jogadores -->
                <div class="mt-8">
                    <div class="flex justify-between items-center mb-2 border-b border-gray-700 pb-2">
                         <h2 class="text-2xl font-semibold">Lista de Jogadores (<span id="player-count">0</span>)</h2>
                         <button id="clear-all-btn" class="text-sm text-gray-400 hover:text-white transition">Limpar Tudo</button>
                    </div>
                    <p id="players-hint" class="text-sm text-gray-500 mb-4">Adicione de 20 a 24 jogadores para sortear os times.</p>
                    <div id="player-list" class="space-y-2 max-h-80 overflow-y-auto pr-2">
                        <!-- Jogadores serão inseridos aqui -->
                    </div>
                </div>
            </div>

            <!-- Coluna de Controles e Times -->
            <div class="bg-gray-800 p-6 rounded-2xl shadow-lg flex flex-col">
                 <h2 class="text-2xl font-semibold mb-4 border-b border-gray-700 pb-2">Controles</h2>
                 <button id="generate-teams-btn" class="w-full text-gray-900 bg-amber-400 hover:bg-amber-500 focus:ring-4 focus:ring-amber-300 font-bold rounded-lg text-lg px-5 py-4 text-center disabled:bg-gray-600 disabled:text-gray-400 disabled:cursor-not-allowed" disabled>
                     Sortear Times
                 </button>
                 <div id="teams-container" class="mt-8 grid grid-cols-1 sm:grid-cols-2 gap-4 flex-grow">
                     <!-- Times sorteados aparecerão aqui -->
                 </div>
            </div>
        </main>

        <footer class="text-center mt-8 py-4 border-t border-gray-700 text-gray-500 text-sm">
            <p>Desenvolvido por <a href="https://github.com/Artur-Antunes-1" target="_blank" rel="noopener noreferrer" class="text-amber-400 hover:underline">Artur Antunes</a></p>
        </footer>
    </div>

    <!-- Modal IA -->
    <div id="ai-modal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-gray-800 rounded-2xl shadow-xl w-full max-w-lg p-6" style="animation: fadeIn 0.3s ease-out;">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-2xl font-semibold text-amber-400">Adicionar Jogadores em Lote</h3>
                <button id="close-ai-modal-btn" class="text-gray-400 hover:text-white">&times;</button>
            </div>
            <p class="text-gray-400 mb-4 text-sm">Cole a lista de jogadores no formato abaixo. A IA irá identificar os nomes e suas respectivas habilidades.</p>
            <textarea id="player-list-input" class="w-full h-64 bg-gray-700 border border-gray-600 rounded-lg p-2.5 text-white focus:ring-amber-500 focus:border-amber-500" placeholder="6 estrelas&#10;Abreu&#10;Gone&#10;&#10;5&#10;Gui&#10;Souto&#10;..."></textarea>
            <div class="mt-6 flex justify-end space-x-4">
                <button id="cancel-ai-btn" class="px-6 py-2 bg-gray-600 hover:bg-gray-700 rounded-lg transition">Cancelar</button>
                <button id="process-ai-btn" class="px-6 py-2 bg-amber-600 hover:bg-amber-700 text-white rounded-lg transition font-semibold">Processar Lista</button>
            </div>
        </div>
    </div>

    <!-- Notificação Toast -->
    <div id="notification" class="fixed top-5 right-5 text-white px-6 py-3 rounded-lg shadow-lg">
        <!-- Mensagem aqui -->
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- VARIÁVEIS DE ESTADO E ELEMENTOS DO DOM ---
            let players = [];
            let currentSkill = 0;

            const addPlayerForm = document.getElementById('add-player-form');
            const playerNameInput = document.getElementById('player-name');
            const starRatingContainer = document.getElementById('star-rating');
            const stars = starRatingContainer.querySelectorAll('.star');
            const playerListContainer = document.getElementById('player-list');
            const playerCountSpan = document.getElementById('player-count');
            const playersHint = document.getElementById('players-hint');
            const generateTeamsBtn = document.getElementById('generate-teams-btn');
            const teamsContainer = document.getElementById('teams-container');
            const clearAllBtn = document.getElementById('clear-all-btn');
            
            // Elementos do Modal e Notificação
            const openAiModalBtn = document.getElementById('open-ai-modal-btn');
            const aiModal = document.getElementById('ai-modal');
            const closeAiModalBtn = document.getElementById('close-ai-modal-btn');
            const cancelAiBtn = document.getElementById('cancel-ai-btn');
            const processAiBtn = document.getElementById('process-ai-btn');
            const playerListInput = document.getElementById('player-list-input');
            const notification = document.getElementById('notification');

            // --- FUNÇÕES ---
            
            // Mostra uma notificação na tela
            const showNotification = (message, isError = false) => {
                notification.textContent = message;
                notification.classList.toggle('bg-red-500', isError);
                notification.classList.toggle('bg-green-500', !isError);
                notification.classList.add('show');
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 3000);
            };

            // Atualiza a exibição das estrelas de habilidade
            const updateStars = (skill) => {
                stars.forEach(star => {
                    const starValue = parseInt(star.dataset.value);
                    star.classList.toggle('active', starValue <= skill);
                });
            };
            
            // Renderiza a lista de jogadores na tela
            const renderPlayerList = () => {
                playerListContainer.innerHTML = '';
                if(players.length === 0){
                    const emptyMessage = document.createElement('p');
                    emptyMessage.textContent = 'Nenhum jogador adicionado ainda.';
                    emptyMessage.className = 'text-gray-500 text-center py-4';
                    playerListContainer.appendChild(emptyMessage);
                } else {
                    players.forEach(player => {
                        const playerEl = document.createElement('div');
                        playerEl.className = 'fade-in flex items-center justify-between bg-gray-700 p-3 rounded-lg';
                        playerEl.innerHTML = `
                            <div>
                                <p class="font-medium">${player.name}</p>
                                <p class="text-amber-400 text-sm">${'★'.repeat(player.skill)}${'☆'.repeat(6 - player.skill)}</p>
                            </div>
                            <button data-id="${player.id}" class="remove-player-btn text-gray-400 hover:text-red-500 transition-colors">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                            </button>
                        `;
                        playerListContainer.appendChild(playerEl);
                    });
                }
                playerCountSpan.textContent = players.length;
                updateGenerateButtonState();
            };

            // Adiciona um jogador à lista
            const addPlayer = (name, skill) => {
                if (skill === 0) {
                    showNotification('Por favor, selecione o nível de habilidade (1-6 estrelas).', true);
                    return;
                }
                players.push({
                    id: Date.now(),
                    name,
                    skill
                });
                renderPlayerList();
            };
            
            // Remove um jogador da lista
            const removePlayer = (id) => {
                players = players.filter(p => p.id !== id);
                renderPlayerList();
                // Limpa os times se um jogador for removido após o sorteio
                teamsContainer.innerHTML = '';
            };
            
            // Atualiza o estado do botão de sortear
            const updateGenerateButtonState = () => {
                const count = players.length;
                if (count >= 20 && count <= 24) {
                    generateTeamsBtn.disabled = false;
                    playersHint.textContent = "Tudo pronto para sortear!";
                    playersHint.className = 'text-sm text-green-400 mb-4';
                } else {
                    generateTeamsBtn.disabled = true;
                    playersHint.textContent = "Adicione de 20 a 24 jogadores para sortear os times.";
                    playersHint.className = 'text-sm text-gray-500 mb-4';
                }
            };
            
            // Sorteia os times de forma balanceada e aleatória
            const generateTeams = () => {
                // 1. Função para embaralhar um array (Fisher-Yates shuffle)
                const shuffle = (array) => {
                    let currentIndex = array.length,  randomIndex;
                    // Enquanto ainda restam elementos para embaralhar
                    while (currentIndex !== 0) {
                        // Pega um elemento restante
                        randomIndex = Math.floor(Math.random() * currentIndex);
                        currentIndex--;
                        // E troca com o elemento atual
                        [array[currentIndex], array[randomIndex]] = [
                            array[randomIndex], array[currentIndex]];
                    }
                    return array;
                };

                // 2. Agrupar jogadores por nível de habilidade (tier)
                const tiers = players.reduce((acc, player) => {
                    const skill = player.skill;
                    if (!acc[skill]) {
                        acc[skill] = [];
                    }
                    acc[skill].push(player);
                    return acc;
                }, {});

                // 3. Embaralhar os jogadores dentro de cada tier
                for (const skill in tiers) {
                    shuffle(tiers[skill]);
                }

                // 4. Juntar os tiers de volta, do maior para o menor skill, criando uma lista semi-aleatória
                const shuffledPlayers = Object.keys(tiers)
                    .sort((a, b) => b - a) // Ordena as chaves (habilidades) de forma decrescente
                    .flatMap(skill => tiers[skill]); // Junta os arrays de jogadores embaralhados
                
                // --- Lógica de distribuição original ---

                // 5. Definir o tamanho dos times
                const totalPlayers = players.length;
                const baseSize = Math.floor(totalPlayers / 4);
                const remainder = totalPlayers % 4;
                const teamSizes = Array(4).fill(baseSize);
                for (let i = 0; i < remainder; i++) { teamSizes[i]++; }

                let teams = Array.from({ length: 4 }, (_, i) => ({
                    name: `Time ${i + 1}`,
                    players: [],
                    totalSkill: 0,
                    capacity: teamSizes[i]
                }));
                
                // 6. Distribuir jogadores usando o método "snake draft" na lista semi-aleatória
                let playerIndex = 0;
                let direction = 1;
                let teamIdx = 0;
                while(playerIndex < shuffledPlayers.length) {
                    if(teams[teamIdx].players.length < teams[teamIdx].capacity) {
                        const player = shuffledPlayers[playerIndex];
                        teams[teamIdx].players.push(player);
                        teams[teamIdx].totalSkill += player.skill;
                        playerIndex++;
                    }
                    teamIdx += direction;
                    if(teamIdx < 0 || teamIdx >= 4) {
                        direction *= -1;
                        teamIdx += direction;
                    }
                }
                renderTeams(teams);
            };

            // Renderiza os times na tela
            const renderTeams = (teams) => {
                teamsContainer.innerHTML = '';
                const teamColors = ['#2563eb', '#db2777', '#16a34a', '#f97316']; // Azul, Rosa, Verde, Laranja

                teams.forEach((team, index) => {
                    const teamCard = document.createElement('div');
                    teamCard.className = 'team-card fade-in bg-gray-900 rounded-xl p-4 flex flex-col';
                    teamCard.style.animationDelay = `${index * 100}ms`;
                    let playersHtml = team.players.map(p => `
                        <li class="flex justify-between items-center py-1">
                            <span>${p.name}</span>
                            <span class="text-amber-400 text-xs">${'★'.repeat(p.skill)}</span>
                        </li>`).join('');
                    teamCard.innerHTML = `
                        <div class="flex justify-between items-center mb-3 pb-2 border-b-2" style="border-color: ${teamColors[index]}">
                            <h3 class="text-xl font-bold">${team.name}</h3>
                            <div class="text-right">
                                <span class="text-xs text-gray-400">Força Total</span>
                                <p class="font-bold text-lg text-amber-400">${team.totalSkill}</p>
                            </div>
                        </div>
                        <ul class="space-y-1 text-gray-300 flex-grow">${playersHtml}</ul>`;
                    teamsContainer.appendChild(teamCard);
                });
            };
            
            // Interpreta o texto do modal e adiciona os jogadores
            const parseAndAddPlayers = () => {
                const text = playerListInput.value;
                const lines = text.split('\n');
                let currentSkill = 0;
                let playersAddedCount = 0;

                lines.forEach(line => {
                    const trimmedLine = line.trim();
                    if (!trimmedLine) return;

                    const skillMatch = trimmedLine.match(/^(\d+)/);
                    if (skillMatch && /^\d+\s*(estrela|estrelas)?\s*$/i.test(trimmedLine)) {
                        const skillValue = parseInt(skillMatch[1], 10);
                        if (skillValue >= 1 && skillValue <= 6) {
                            currentSkill = skillValue;
                            return;
                        }
                    }
                    
                    if (currentSkill > 0 && trimmedLine.length > 0) {
                        players.push({
                            id: Date.now() + Math.random(),
                            name: trimmedLine,
                            skill: currentSkill
                        });
                        playersAddedCount++;
                    }
                });
                
                if (playersAddedCount > 0) {
                    renderPlayerList();
                    showNotification(`${playersAddedCount} jogadores foram adicionados com sucesso!`);
                } else {
                    showNotification('Nenhum jogador foi adicionado. Verifique o formato da lista.', true);
                }
                aiModal.classList.add('hidden');
                playerListInput.value = '';
            };

            // Limpa todos os dados e reseta a interface
            const clearAll = () => {
                players = [];
                currentSkill = 0;
                playerNameInput.value = '';
                updateStars(0);
                renderPlayerList();
                teamsContainer.innerHTML = '';
            };

            // --- EVENT LISTENERS ---

            starRatingContainer.addEventListener('click', (e) => {
                const star = e.target.closest('.star');
                if (star) {
                    currentSkill = parseInt(star.dataset.value);
                    starRatingContainer.dataset.skill = currentSkill;
                    updateStars(currentSkill);
                }
            });
            starRatingContainer.addEventListener('mouseover', (e) => {
                const star = e.target.closest('.star');
                if (star) { updateStars(parseInt(star.dataset.value)); }
            });
            starRatingContainer.addEventListener('mouseout', () => { updateStars(currentSkill); });

            addPlayerForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const name = playerNameInput.value.trim();
                if (name) {
                    addPlayer(name, currentSkill);
                    playerNameInput.value = '';
                    currentSkill = 0;
                    starRatingContainer.dataset.skill = 0;
                    updateStars(0);
                    playerNameInput.focus();
                }
            });
            
            playerListContainer.addEventListener('click', (e) => {
                const removeBtn = e.target.closest('.remove-player-btn');
                if (removeBtn) { 
                    const id = parseFloat(removeBtn.dataset.id); 
                    removePlayer(id); 
                }
            });
            
            generateTeamsBtn.addEventListener('click', generateTeams);
            clearAllBtn.addEventListener('click', clearAll);

            // Listeners do Modal
            openAiModalBtn.addEventListener('click', () => { aiModal.classList.remove('hidden'); });
            const closeModal = () => { aiModal.classList.add('hidden'); };
            closeAiModalBtn.addEventListener('click', closeModal);
            cancelAiBtn.addEventListener('click', closeModal);
            processAiBtn.addEventListener('click', parseAndAddPlayers);

            // --- INICIALIZAÇÃO ---
            renderPlayerList();
        });
    </script>
</body>
</html>




